local WindUI = loadstring(game:HttpGet("https://tree-hub.vercel.app/api/UI/WindUI"))()

--[[ CONFIGURAÇÕES DO JUNKIE ]]
local JunkieConfig = {
    ApiID = "e696e91d-0ba0-4693-a6a5-91145ead6ed1",
    ServiceID = "Khalexis Hub - Key",
    GetKeyLink = "https://linkunlocker.com/key-1-RG8TS?share=true",
    FileName = "KhalexisHub_Key.txt" -- Nome do arquivo para salvar a key
}

--[[ 
    [SISTEMA INTELIGENTE DE VERIFICAÇÃO]
    Isso verifica se o usuário já tem uma key salva válida antes de carregar o WindUI.
    Se a key for válida, o KeySystem não aparecerá na janela.
]]
local AlreadyLogged = false
if isfile(JunkieConfig.FileName) then
    local savedKey = readfile(JunkieConfig.FileName):gsub("%s+", "")
    if savedKey ~= "" then
        -- Verificação silenciosa usando o SDK do Junkie
        local success, isValid = pcall(function()
            local JunkieLib = loadstring(game:HttpGet("https://junkie-development.de/sdk/JunkieKeySystem.lua"))()
            return JunkieLib.verifyKey(JunkieConfig.ApiID, savedKey, JunkieConfig.ServiceID)
        end)
        
        if success and isValid then
            AlreadyLogged = true
        end
    end
end

--[[ DEFINIÇÃO DO SERVIÇO CUSTOMIZADO (JUNKIE) PARA O WINDUI ]]
WindUI.Services.JunkieAuth = {
    Name = "Junkie System",
    Icon = "key",
    Args = { "Api", "Service" }, -- Argumentos passados na tabela API

    New = function(Api, Service)
        
        -- Função que valida quando o usuário clica em "Check Key"
        local function validateKey(keyInput)
            keyInput = keyInput:gsub("%s+", "") -- Remove espaços extras
            
            if not keyInput or keyInput == "" then
                return false, "Por favor, insira uma key!"
            end

            -- Chamando o SDK Oficial do Junkie (igual sua referência)
            local success, isValid = pcall(function()
                local JunkieLib = loadstring(game:HttpGet("https://junkie-development.de/sdk/JunkieKeySystem.lua"))()
                return JunkieLib.verifyKey(Api, keyInput, Service)
            end)

            if success and isValid then
                -- Salva a key no arquivo se for válida
                if writefile then
                    writefile(JunkieConfig.FileName, keyInput)
                end
                return true, "Key Validada com Sucesso!"
            else
                return false, "Key Inválida ou Expirada!"
            end
        end
        
        -- Função para copiar o link
        local function copyLink()
            if setclipboard then
                setclipboard(JunkieConfig.GetKeyLink)
                return "Link copiado para a área de transferência!"
            end
            return "Seu executor não suporta copiar link."
        end
        
        return {
            Verify = validateKey,
            Copy = copyLink
        }
    end
}

--[[ CRIANDO A JANELA ]]
-- Definimos as opções da janela
local WindowOptions = {
    Title = "Khalexis Hub",
    Icon = "rbxassetid://10000000000", 
    Author = "Khalexis",
    Folder = "KhalexisHub",
    Transparent = true,
    Theme = "Dark",
}

-- Só adiciona o sistema de Key se o usuário NÃO estiver logado automaticamente
if not AlreadyLogged then
    WindowOptions.KeySystem = {
        Note = "Powered by Junkie Services",
        API = {
            {
                Type = "JunkieAuth", -- Usa nosso serviço criado acima
                Title = "Khalexis Hub - Key",
                Desc = "Copie o link para gerar sua key.",
                Icon = "key",
                
                -- Passando os dados para o serviço
                Api = JunkieConfig.ApiID,
                Service = JunkieConfig.ServiceID,
            },
        },
    }
end

local Window = WindUI:CreateWindow(WindowOptions)

--[[ SEU SCRIPT DO HUB COMEÇA AQUI ]]
-- Tudo abaixo só será carregado se a key for válida (ou se já estiver salva)

local Tab = Window:CreateTab({
    Name = "Principal",
    Icon = "home"
})

Tab:Section({ Title = "Bem vindo ao Khalexis Hub" })

Tab:Button({
    Name = "Teste de Execução",
    Callback = function()
        WindUI:Notify({
            Title = "Sucesso",
            Content = "O Hub está funcionando e validado!",
            Duration = 5
        })
    end
})

-- Notificação de boas-vindas
WindUI:Notify({
    Title = "Autenticado",
    Content = AlreadyLogged and "Login automático efetuado!" or "Key verificada com sucesso!",
    Duration = 5,
    Icon = "check"
})
